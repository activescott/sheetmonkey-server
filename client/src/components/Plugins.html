<div id="justforpadding" style="padding:15px">
  <div class="panel panel-default">
    <!--See http://getbootstrap.com/components/#panels-tables -->
    <div class="panel-heading">Plugins</div>
    <div class="panel-body">
      <p>Below are your registered plugins. You can view, edit, and delete them here.</p>
    </div>

    <table id="tblplugins" class="table">
      <thead>
      <tr>
        <th>Manifest URL</th>
        <th>&nbsp;</th>
      </tr>
      </thead>
      <tbody>
        {{#each plugins as plugin}}
        <tr>
          <td>{{plugin.manifestUrl}}</td>
          <td><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</div>

<script>
  import Actions from '../actions'
  import Backend from '../lib/Backend'

  export default {
    methods: {
      getPlugins () {
        let store = this.get('store')
        console.log('pluginsStore:', store)
        let state = store.getState()
        console.log('pluginsState:', state)
        if (!state.user || !state.user.id) {
          throw new Error('User must be logged in to list plugins.')
        }
        this.backend.getPlugins(state.user.id).then(response => {
          console.log('getPlugins backend response:', response)
          const plugins = response
          const action = Actions.setPlugins(plugins)
          this.get('store').dispatch(action)
        })
      }
    },
    data () {
      // note: Data supplied at instantiation (i.e. new Component(...)) takes priority over defaults.
      return {
        plugins: [],
        store: null
      }
    },
    oncreate () {
      const store = this.get('store')
      console.log('Plugins DOM Loaded with store:', store)
      console.assert(store, 'redux store must be provided by initializer of this component!')
      this.backend = Backend.build()
      store.subscribe(() => {
        console.log('Plugins subscribe store:', store)
        let state = store.getState()
        console.log('Plugins subscribe state:', state)
        this.set(state) // this should not overwrite the existing store property in the local state.
      })
      this.getPlugins()
    }

  }
</script>
